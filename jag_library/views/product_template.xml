<?xml version="1.0" encoding="utf-8" ?>
<odoo>
    <record id="product_template_form_view_inherit_is_book" model="ir.ui.view">
        <field name="name">product.template.form.inherit.is.book</field>
        <field name="model">product.template</field>
        <field name="inherit_id" ref="product.product_template_form_view" />
        <field name="arch" type="xml">
            <xpath expr="//div[@name='options']/span[last()]" position="after">
                <span class="d-inline-flex ms-3">
                    <field name="is_book" />
                    <label for="is_book" />
                </span>
            </xpath>
            <xpath expr="//notebook" position="inside">
                <page string="Book Information" name="book_info" invisible="is_book==False">
                    <group>
                        <group string="Publication Details">
                            <field name="publisher_id" domain="[('is_publisher', '=', True)]" context="{'default_is_company': True, 'default_is_publisher': True}" />
                            <field name="publisher_country_id" />
                            <field name="publication_date" />
                            <field name="publication_year" />
                            <field name="binding" />
                            <field name="edition" />
                            <field name="number_of_pages" />
                            <field name="language" context="{'active_test': False}" />
                        </group>
                        <group string="Library Details">
                            <field name="author_ids" widget="many2many_tags" domain="[('is_author', '=', True)]" context="{'default_is_author': True}" />
                            <field name="genre_ids" widget="many2many_tags" options="{'color_field': 'color'}" />
                            <field name="isbn" />
                            <field name="condition" />
                            <field name="copies" />
                            <field name="location" />
                        </group>
                    </group>
                    <group string="Synopsis">
                        <field name="synopsis" nolabel="1" />
                    </group>
                </page>
                <page string="Images" name="cover_image" invisible="is_book==False">
                        <group>
                            <group string="Cover Image">
                                <div class="text-center" style="max-width: 512px; margin: 0 auto;">
                                    <field name="image_1920" widget="image" nolabel="1" />
                                </div>
                            </group>
                            <group string="Back Cover">
                                <div class="text-center" style="max-width: 512px; margin: 0 auto;">
                                    <field name="image_back_cover_1920" widget="image" nolabel="1" />
                                </div>
                            </group>
                        </group>
                    </page>
                    <page string="Reading Notes" name="reading_notes" invisible="is_book==False">
                        <group>
                            <group string="Date started reading">
                                <field name="date_start_reading" nolabel="1" />
                                </group>
                            <group string="Date finished reading">
                                <field name="date_end_reading" nolabel="1" />
                            </group>
                            <group string="Rating">
                                <field name="rating" widget="priority" />
                            </group>
                        </group>
                        <group string="Reading Notes">
                            <field name="reading_notes" nolabel="1" />
                        </group>
                    </page>
                </xpath>
            <xpath expr="//header" position="inside">
                <button name="button_check_isbn" type="object" string="Verify ISBN" class="oe_highlight" invisible="not is_book" />
            </xpath>
        </field>
    </record>

    <record id="product_template_search_view_inherit_is_book" model="ir.ui.view">
        <field name="name">product.template.search.inherit.is.book</field>
        <field name="model">product.template</field>
        <field name="inherit_id" ref="product.product_template_search_view" />
        <field name="arch" type="xml">
            <xpath expr="//filter[@name='services']" position="after">
                <separator />
                <filter name="filter_is_book" string="Is Book" domain="[('is_book', '=', True)]" />
            </xpath>
        </field>
    </record>

    <record id="product_template_kanban_view_books" model="ir.ui.view">
        <field name="name">product.template.kanban.books</field>
        <field name="model">product.template</field>
        <field name="arch" type="xml">
            <kanban default_order="location,sequence asc" records_per_row="4">
                <field name="name"/>
                <field name="image_1920"/>
                <field name="publisher_id"/>
                <field name="author_ids"/>
                <field name="number_of_pages"/>
                <field name="genre_ids"/>
                <templates>
                    <t t-name="card">
                        <div class="oe_kanban_global_click d-flex flex-row p-0 shadow-sm rounded">
                            <div class="o_kanban_image" style="flex: 0 0 150px;">
                                <img class="o_kanban_image_fill position-relative w-100" t-att-src="!record.image_1920.raw_value ? '/web/static/src/img/placeholder.png' : `/web/image/product.template/${record.id.raw_value}/image_1920`" alt="Cover"/>
                            </div>
                            <div class="oe_kanban_details d-flex flex-column flex-grow-1 p-1" style="min-height: 180px;">
                                <div>
                                    <strong class="o_kanban_record_title mb-2 d-block"><field name="name"/></strong>
                                    <div class="text-muted">
                                        <div class="d-flex mb-2">
                                            <div t-if="record.publisher_id.value" title="Publisher" class=""><i class="oi oi-building me-1"/><span style="font-weight: bold;"><field name="publisher_id"/></span></div>
                                        </div>
                                        <div class="d-flex mb-2">
                                            <div t-if="record.number_of_pages.raw_value" title="Pages" class=""><i class="oi oi-page me-1"/><span><field name="number_of_pages"/> pages</span></div>
                                        </div>
                                        <div t-if="record.author_ids.raw_value.length > 0" title="Author(s)" class="d-flex align-items-start">
                                            <i class="oi oi-community mt-1 flex-shrink-0"/>
                                            <div class="w-100"><field name="author_ids" widget="many2many_tags"/></div>
                                        </div>
                                        <div class="d-flex align-items-start mt-2">
                                            <i class="oi oi-community mt-1 flex-shrink-0"/>
                                            <div class="w-100"><field name="rating" widget="priority"/></div>
                                        </div>

                                    </div>
                                </div>


                            </div>
                        </div>
                        <div t-if="record.genre_ids.raw_value.length > 0" class="d-flex align-items-start mt-2" title="GÃ©neros">
                            <i class="oi oi-tag me-2 mt-1 flex-shrink-0"/>
                            <div class="w-100"><field name="genre_ids" widget="many2many_tags" options="{'color_field': 'color'}" /></div>
                        </div>

                    </t>
                </templates>
                <style>
                    .o_kanban_image_cover {
                        width: 100%;
                        height: 100%;
                        object-fit: cover; /* La magia para que se comporte como una portada */
                        object-position: center;
                    }
                </style>
            </kanban>
        </field>
    </record>

    <record id="product_template_tree_view_inherit_sequence" model="ir.ui.view">
        <field name="name">product.template.tree.view.inherit.sequence</field>
        <field name="model">product.template</field>
        <field name="inherit_id" ref="product.product_template_tree_view"/>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='name']" position="before">
                <field name="sequence" widget="handle"/>
            </xpath>
        </field>
    </record>

    <record id="product_template_search_view_books" model="ir.ui.view">
        <field name="name">product.template.search.books</field>
        <field name="model">product.template</field>
        <field name="arch" type="xml">
            <search string="Buscar Libros">
                <field name="name" string="Name"/>
                <field name="publisher_id" string="Publisher"/>
                <field name="genre_ids" string="Genre"/>
                <field name="author_ids" string="Author"/>
                <separator/>


            </search>
        </field>
    </record>
</odoo>
